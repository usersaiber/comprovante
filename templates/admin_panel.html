<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Painel Administrativo - Comprovante de Recebimento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-3">
        <div class="text-center mb-3">
            <img src="{{ url_for('static', filename='logo.jpg') }}" alt="Logo Mantoma" class="img-fluid" style="max-width: 200px;">
        </div>
        <h1 class="text-center mb-4">Painel Administrativo</h1>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <h2>Gerenciar Nomes</h2>
        <form method="POST" action="{{ url_for('create_name') }}">
            <div class="mb-3">
                <label for="name" class="form-label">Novo Nome:</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <button type="submit" class="btn btn-primary">Criar Nome</button>
        </form>
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                </tr>
            </thead>
            <tbody>
                {% for name in names %}
                <tr>
                    <td>{{ name.id }}</td>
                    <td>{{ name.name }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>Gerenciar Setores</h2>
        <form method="POST" action="{{ url_for('create_sector') }}">
            <div class="mb-3">
                <label for="sector" class="form-label">Novo Setor:</label>
                <input type="text" class="form-control" id="sector" name="sector" required>
            </div>
            <button type="submit" class="btn btn-primary">Criar Setor</button>
        </form>
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Setor</th>
                </tr>
            </thead>
            <tbody>
                {% for sector in sectors %}
                <tr>
                    <td>{{ sector.id }}</td>
                    <td>{{ sector.name }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>Gerenciar Usuários</h2>
        <form method="POST" action="{{ url_for('create_user') }}">
            <div class="mb-3">
                <label for="username" class="form-label">Novo Usuário:</label>
                <input type="text" class="form-control" id="username" name="username" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Senha:</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <button type="submit" class="btn btn-primary">Criar Usuário</button>
        </form>
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Usuário</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>Comprovantes Submetidos</h2>
        <a href="{{ url_for('download_pdf') }}" class="btn btn-primary mt-3">Baixar Relatório em PDF</a>
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Usuário</th>
                    <th>Nome</th>
                    <th>Setor Origem</th>
                    <th>Setor Destino</th>
                    <th>Valor (R$)</th>
                    <th>Autorizado</th>
                    <th>Assinatura</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody>
                {% for receipt in receipts %}
                <tr>
                    <td>{{ receipt.id }}</td>
                    <td>{{ receipt.user.username if receipt.user else 'Usuário não encontrado' }}</td>
                    <td>{{ receipt.name }}</td>
                    <td>{{ receipt.sector_origin }}</td>
                    <td>{{ receipt.sector_destination }}</td>
                    <td>{{ '%.2f' % receipt.amount }}</td>
                    <td>{{ 'Sim' if receipt.authorized else 'Não' }}</td>
                    <td>
                        {% if receipt.signature %}
                            <img src="{{ receipt.signature }}" alt="Assinatura" style="max-width: 100px; max-height: 50px;">
                        {% else %}
                            Não informada
                        {% endif %}
                    </td>
                    <td>{{ receipt.submission_date.strftime('%d/%m/%Y %H:%M') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <a href="{{ url_for('index') }}" class="btn btn-secondary mt-3">Voltar ao Formulário</a>
        <a href="{{ url_for('logout') }}" class="btn btn-danger mt-3">Sair</a>
        <div class="text-center mt-3 text-muted">
            <small>Gerenciado por <strong>Cleiton Teixeira - TI Mantoma</strong></small>
        </div>
    </div>
</body>
</html>